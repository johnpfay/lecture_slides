<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data manipulation with dplyr</title>
    <meta charset="utf-8" />
    <meta name="author" content="Shawn Santo" />
    <link rel="stylesheet" href="slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Data manipulation with dplyr
## Programming for Statistical Science
### Shawn Santo

---




## Supplementary materials

Full video lecture available in Zoom Cloud Recordings

Additional resources

- `dplyr` [cheat sheet](https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf)
- [dplyr vignette](https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html)
- [Chapter 5](https://r4ds.had.co.nz/transform.html), R for Data Science

---

## Getting started


```r
library(tidyverse)
```

```r
── Attaching packages ──────────────── tidyverse 1.3.0 ──
✓ ggplot2 3.3.2     ✓ purrr   0.3.4
✓ tibble  3.0.3     ✓ dplyr   1.0.0
✓ tidyr   1.1.0     ✓ stringr 1.4.0
✓ readr   1.3.1     ✓ forcats 0.5.0
── Conflicts ────────────────────── tidyverse_conflicts() ──
x dplyr::filter() masks stats::filter()
x dplyr::lag()    masks stats::lag()
```

Also, load `nycflights13`.


```r
library(nycflights13)
```

---

class: inverse, center, middle

# Pipes

---

## Pipes in R

Infix function `%&gt;%` is a forward-pipe operator. It allows you to pipe an object
forward into a function or call expression.

You can think about the following sequence of actions - 
find keys, unlock car, start car, drive to school, park.

&lt;br/&gt;

Expressed as a set of nested functions in R pseudo code this would look like:


```r
park(drive(start_car(unlock_car(find("keys"))), to = "campus"))
```

&lt;br/&gt;

Writing it out using pipes give it a more natural (and easier to read) 
structure:


```r
find("keys") %&gt;%
  unlock_car() %&gt;% 
  start_car() %&gt;%
  drive(to = "campus") %&gt;%
  park()
```

---

## Approaches

All of the following are fine, it comes down to personal preference.

Nested:


```r
h(g(f(x), y = 1), z = 1)
```

Piped:


```r
f(x) %&gt;% 
  g(y = 1) %&gt;% 
  h(z = 1)
```

Intermediate:


```r
res &lt;- f(x)
res &lt;- g(res, y = 1)
res &lt;- h(res, z = 1)
```

---

## What about other arguments?

By default, the object on the left-hand side of ` %&gt;% ` is placed as the value
to the first argument in the function on the right-hand side of ` %&gt;% `.

To pass the value to other arguments a `.` is used. For example,

--


```r
data.frame(a = 1:3, b = 3:1) %&gt;% lm(a ~ b, data = .)
```

```
#&gt; 
#&gt; Call:
#&gt; lm(formula = a ~ b, data = .)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)            b  
#&gt;           4           -1
```

--


```r
data.frame(a = 1:3, b = 3:1) %&gt;% .[[1]]
```

```
#&gt; [1] 1 2 3
```

--


```r
data.frame(a = 1:3, b = 3:1) %&gt;% .[[length(.)]]
```

```
#&gt; [1] 3 2 1
```

---
class: inverse, center, middle

# Data wrangling with `dplyr`

---

## A grammar of data manipulation

Package `dplyr` is based on the concepts of functions as verbs 
that manipulate data frames.

Single data frame functions / verbs:

.small-text[
| Function                       | Description                          |
|--------------------------------|--------------------------------------|
| `filter()`                     | pick rows matching criteria          |
| `slice()`                      | pick rows using indices              |
| `select()`                     | pick columns by name                 |
| `pull()`                       | grab a column as a vector            |
| `rename()`                     | rename specific columns              |
| `arrange()`                    | reorder rows                         |
| `mutate()`                     | add new variables                    |
| `transmute()`                  | create new data frame with variables |
| `distinct()`                   | filter for unique rows               |
| `sample_n()` / `sample_frac()` | randomly sample rows                 |
| `summarise()`                  | reduce variables to values           |
]

... many more.

---

## `dplyr` rules

1. First argument is *always* a data frame

2. Subsequent arguments say what to do with that data frame

3. Almost always returns a data frame

4. Doesn't modify in place

&lt;br/&gt;&lt;br/&gt;

Based on rules 1 and 3, it is natural to apply ` %&gt;% ` in a sequence
of `dplyr` functions for data wrangling purposes.

---

## Data

We will demonstrate `dplyr`'s functionality using the `nycflights13` package.

.small[

```r
flights
```

```
#&gt; # A tibble: 336,776 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      517            515         2      830            819
#&gt;  2  2013     1     1      533            529         4      850            830
#&gt;  3  2013     1     1      542            540         2      923            850
#&gt;  4  2013     1     1      544            545        -1     1004           1022
#&gt;  5  2013     1     1      554            600        -6      812            837
#&gt;  6  2013     1     1      554            558        -4      740            728
#&gt;  7  2013     1     1      555            600        -5      913            854
#&gt;  8  2013     1     1      557            600        -3      709            723
#&gt;  9  2013     1     1      557            600        -3      838            846
#&gt; 10  2013     1     1      558            600        -2      753            745
#&gt; # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---

## `filter()` - March flights

.small[

```r
flights %&gt;% 
  filter(month == 3)
```

```
#&gt; # A tibble: 28,834 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     3     1        4           2159       125      318             56
#&gt;  2  2013     3     1       50           2358        52      526            438
#&gt;  3  2013     3     1      117           2245       152      223           2354
#&gt;  4  2013     3     1      454            500        -6      633            648
#&gt;  5  2013     3     1      505            515       -10      746            810
#&gt;  6  2013     3     1      521            530        -9      813            827
#&gt;  7  2013     3     1      537            540        -3      856            850
#&gt;  8  2013     3     1      541            545        -4     1014           1023
#&gt;  9  2013     3     1      549            600       -11      639            703
#&gt; 10  2013     3     1      550            600       -10      747            801
#&gt; # … with 28,824 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---

## `filter()` - flights in the first 7 days of March

.small[

```r
flights %&gt;% 
  filter(month == 3, day &lt;= 7)
```

```
#&gt; # A tibble: 6,530 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     3     1        4           2159       125      318             56
#&gt;  2  2013     3     1       50           2358        52      526            438
#&gt;  3  2013     3     1      117           2245       152      223           2354
#&gt;  4  2013     3     1      454            500        -6      633            648
#&gt;  5  2013     3     1      505            515       -10      746            810
#&gt;  6  2013     3     1      521            530        -9      813            827
#&gt;  7  2013     3     1      537            540        -3      856            850
#&gt;  8  2013     3     1      541            545        -4     1014           1023
#&gt;  9  2013     3     1      549            600       -11      639            703
#&gt; 10  2013     3     1      550            600       -10      747            801
#&gt; # … with 6,520 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---

## `filter()` - flights to LAX *or* RDU in March

.small[

```r
flights %&gt;%
  filter(dest == "LAX" | dest == "RDU", month == 3)
```

```
#&gt; # A tibble: 1,935 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     3     1      607            610        -3      832            925
#&gt;  2  2013     3     1      608            615        -7      737            750
#&gt;  3  2013     3     1      623            630        -7      753            810
#&gt;  4  2013     3     1      629            632        -3      844            952
#&gt;  5  2013     3     1      657            700        -3      953           1034
#&gt;  6  2013     3     1      714            715        -1      939           1037
#&gt;  7  2013     3     1      716            710         6      958           1035
#&gt;  8  2013     3     1      727            730        -3     1007           1100
#&gt;  9  2013     3     1      803            810        -7      923            955
#&gt; 10  2013     3     1      823            824        -1      954           1014
#&gt; # … with 1,925 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---

## `slice()` - first 10 flights

.small[

```r
flights %&gt;% 
  slice(1:10)
```

```
#&gt; # A tibble: 10 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      517            515         2      830            819
#&gt;  2  2013     1     1      533            529         4      850            830
#&gt;  3  2013     1     1      542            540         2      923            850
#&gt;  4  2013     1     1      544            545        -1     1004           1022
#&gt;  5  2013     1     1      554            600        -6      812            837
#&gt;  6  2013     1     1      554            558        -4      740            728
#&gt;  7  2013     1     1      555            600        -5      913            854
#&gt;  8  2013     1     1      557            600        -3      709            723
#&gt;  9  2013     1     1      557            600        -3      838            846
#&gt; 10  2013     1     1      558            600        -2      753            745
#&gt; # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#&gt; #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---

## `slice()` - last 5 flights

.small[

```r
flights %&gt;% 
  slice((n() - 4):n())
```

```
#&gt; # A tibble: 5 x 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt; 1  2013     9    30       NA           1455        NA       NA           1634
#&gt; 2  2013     9    30       NA           2200        NA       NA           2312
#&gt; 3  2013     9    30       NA           1210        NA       NA           1330
#&gt; 4  2013     9    30       NA           1159        NA       NA           1344
#&gt; 5  2013     9    30       NA            840        NA       NA           1020
#&gt; # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#&gt; #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---

## `select()` - specific variables


```r
flights %&gt;% 
  select(year, month, day)
```

```
#&gt; # A tibble: 336,776 x 3
#&gt;     year month   day
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt;  1  2013     1     1
#&gt;  2  2013     1     1
#&gt;  3  2013     1     1
#&gt;  4  2013     1     1
#&gt;  5  2013     1     1
#&gt;  6  2013     1     1
#&gt;  7  2013     1     1
#&gt;  8  2013     1     1
#&gt;  9  2013     1     1
#&gt; 10  2013     1     1
#&gt; # … with 336,766 more rows
```

---

## `select()` - exclude variables

.small[

```r
flights %&gt;% 
  select(-year, -month, -day)
```

```
#&gt; # A tibble: 336,776 x 16
#&gt;    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier
#&gt;       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1      517            515         2      830            819        11 UA     
#&gt;  2      533            529         4      850            830        20 UA     
#&gt;  3      542            540         2      923            850        33 AA     
#&gt;  4      544            545        -1     1004           1022       -18 B6     
#&gt;  5      554            600        -6      812            837       -25 DL     
#&gt;  6      554            558        -4      740            728        12 UA     
#&gt;  7      555            600        -5      913            854        19 B6     
#&gt;  8      557            600        -3      709            723       -14 EV     
#&gt;  9      557            600        -3      838            846        -8 B6     
#&gt; 10      558            600        -2      753            745         8 AA     
#&gt; # … with 336,766 more rows, and 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---

## `select()` - ranges


```r
flights %&gt;% 
  select(year:day)
```

```
#&gt; # A tibble: 336,776 x 3
#&gt;     year month   day
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt;  1  2013     1     1
#&gt;  2  2013     1     1
#&gt;  3  2013     1     1
#&gt;  4  2013     1     1
#&gt;  5  2013     1     1
#&gt;  6  2013     1     1
#&gt;  7  2013     1     1
#&gt;  8  2013     1     1
#&gt;  9  2013     1     1
#&gt; 10  2013     1     1
#&gt; # … with 336,766 more rows
```

---

## `select()` - exclude ranges

.small[

```r
flights %&gt;% 
  select(-(year:day))
```

```
#&gt; # A tibble: 336,776 x 16
#&gt;    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier
#&gt;       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1      517            515         2      830            819        11 UA     
#&gt;  2      533            529         4      850            830        20 UA     
#&gt;  3      542            540         2      923            850        33 AA     
#&gt;  4      544            545        -1     1004           1022       -18 B6     
#&gt;  5      554            600        -6      812            837       -25 DL     
#&gt;  6      554            558        -4      740            728        12 UA     
#&gt;  7      555            600        -5      913            854        19 B6     
#&gt;  8      557            600        -3      709            723       -14 EV     
#&gt;  9      557            600        -3      838            846        -8 B6     
#&gt; 10      558            600        -2      753            745         8 AA     
#&gt; # … with 336,766 more rows, and 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---

## `select()` - matching

.small[

```r
flights %&gt;% 
  select(contains("dep"), contains("arr"))
```

```
#&gt; # A tibble: 336,776 x 7
#&gt;    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier
#&gt;       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1      517            515         2      830            819        11 UA     
#&gt;  2      533            529         4      850            830        20 UA     
#&gt;  3      542            540         2      923            850        33 AA     
#&gt;  4      544            545        -1     1004           1022       -18 B6     
#&gt;  5      554            600        -6      812            837       -25 DL     
#&gt;  6      554            558        -4      740            728        12 UA     
#&gt;  7      555            600        -5      913            854        19 B6     
#&gt;  8      557            600        -3      709            723       -14 EV     
#&gt;  9      557            600        -3      838            846        -8 B6     
#&gt; 10      558            600        -2      753            745         8 AA     
#&gt; # … with 336,766 more rows
```
]

---


```r
flights %&gt;% 
  select(starts_with("dep"), starts_with("arr"))
```

```
#&gt; # A tibble: 336,776 x 4
#&gt;    dep_time dep_delay arr_time arr_delay
#&gt;       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
#&gt;  1      517         2      830        11
#&gt;  2      533         4      850        20
#&gt;  3      542         2      923        33
#&gt;  4      544        -1     1004       -18
#&gt;  5      554        -6      812       -25
#&gt;  6      554        -4      740        12
#&gt;  7      555        -5      913        19
#&gt;  8      557        -3      709       -14
#&gt;  9      557        -3      838        -8
#&gt; 10      558        -2      753         8
#&gt; # … with 336,766 more rows
```


Other helpers: `ends_with()`, `matches()`, `num_range()`, `one_of()`, 
`everything()`, `last_col()`

---

## `select_if()` 


```r
flights %&gt;% 
  select_if(function(x) !is.numeric(x))
```

```
#&gt; # A tibble: 336,776 x 5
#&gt;    carrier tailnum origin dest  time_hour          
#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;dttm&gt;             
#&gt;  1 UA      N14228  EWR    IAH   2013-01-01 05:00:00
#&gt;  2 UA      N24211  LGA    IAH   2013-01-01 05:00:00
#&gt;  3 AA      N619AA  JFK    MIA   2013-01-01 05:00:00
#&gt;  4 B6      N804JB  JFK    BQN   2013-01-01 05:00:00
#&gt;  5 DL      N668DN  LGA    ATL   2013-01-01 06:00:00
#&gt;  6 UA      N39463  EWR    ORD   2013-01-01 05:00:00
#&gt;  7 B6      N516JB  EWR    FLL   2013-01-01 06:00:00
#&gt;  8 EV      N829AS  LGA    IAD   2013-01-01 06:00:00
#&gt;  9 B6      N593JB  JFK    MCO   2013-01-01 06:00:00
#&gt; 10 AA      N3ALAA  LGA    ORD   2013-01-01 06:00:00
#&gt; # … with 336,766 more rows
```

--

Alternatively,


```r
flights %&gt;% 
  select_if(~!is.numeric(.))
```

---

## `pull()` - grab a vector


```r
names(flights)
```

```
#&gt;  [1] "year"           "month"          "day"            "dep_time"      
#&gt;  [5] "sched_dep_time" "dep_delay"      "arr_time"       "sched_arr_time"
#&gt;  [9] "arr_delay"      "carrier"        "flight"         "tailnum"       
#&gt; [13] "origin"         "dest"           "air_time"       "distance"      
#&gt; [17] "hour"           "minute"         "time_hour"
```

```r
flights %&gt;% pull("year") %&gt;% head()
```

```
#&gt; [1] 2013 2013 2013 2013 2013 2013
```

--


```r
flights %&gt;% pull(1) %&gt;% head
```

```
#&gt; [1] 2013 2013 2013 2013 2013 2013
```

--


```r
flights %&gt;% pull(-1) %&gt;% .[1:4]
```

```
#&gt; [1] "2013-01-01 05:00:00 EST" "2013-01-01 05:00:00 EST"
#&gt; [3] "2013-01-01 05:00:00 EST" "2013-01-01 05:00:00 EST"
```

---

## `arrange()` - sort data

.small[

```r
flights %&gt;%
  filter(month == 3, day == 2) %&gt;%
  arrange(origin, dest)
```

```
#&gt; # A tibble: 765 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     3     2     1336           1329         7     1426           1432
#&gt;  2  2013     3     2      628            629        -1      837            849
#&gt;  3  2013     3     2      637            640        -3      903            915
#&gt;  4  2013     3     2      743            745        -2      945           1010
#&gt;  5  2013     3     2      857            900        -3     1117           1126
#&gt;  6  2013     3     2     1027           1030        -3     1234           1247
#&gt;  7  2013     3     2     1134           1145       -11     1332           1359
#&gt;  8  2013     3     2     1412           1415        -3     1636           1630
#&gt;  9  2013     3     2     1633           1636        -3     1848           1908
#&gt; 10  2013     3     2     1655           1700        -5     1857           1924
#&gt; # … with 755 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#&gt; #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---

## `arrange()` &amp; `desc()`

By default, sorting is done in ascending order. To change that, use `desc()`.


```r
flights %&gt;% 
  filter(month == 3, day == 2) %&gt;% 
  arrange(desc(origin), dest) %&gt;% 
  select(origin, dest, tailnum)
```

```
#&gt; # A tibble: 765 x 3
#&gt;    origin dest  tailnum
#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  
#&gt;  1 LGA    ATL   N928AT 
#&gt;  2 LGA    ATL   N623DL 
#&gt;  3 LGA    ATL   N680DA 
#&gt;  4 LGA    ATL   N996AT 
#&gt;  5 LGA    ATL   N510MQ 
#&gt;  6 LGA    ATL   N663DN 
#&gt;  7 LGA    ATL   N942DL 
#&gt;  8 LGA    ATL   N511MQ 
#&gt;  9 LGA    ATL   N910DE 
#&gt; 10 LGA    ATL   N902DE 
#&gt; # … with 755 more rows
```

---

## `mutate()` - modify columns


```r
flights %&gt;%
  select(year:day) %&gt;%
  mutate(date = paste(year, month, day, sep = "/"))
```

```
#&gt; # A tibble: 336,776 x 4
#&gt;     year month   day date    
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
#&gt;  1  2013     1     1 2013/1/1
#&gt;  2  2013     1     1 2013/1/1
#&gt;  3  2013     1     1 2013/1/1
#&gt;  4  2013     1     1 2013/1/1
#&gt;  5  2013     1     1 2013/1/1
#&gt;  6  2013     1     1 2013/1/1
#&gt;  7  2013     1     1 2013/1/1
#&gt;  8  2013     1     1 2013/1/1
#&gt;  9  2013     1     1 2013/1/1
#&gt; 10  2013     1     1 2013/1/1
#&gt; # … with 336,766 more rows
```

---

## `transmute()` - create tibble from existing columns


```r
flights %&gt;%
  transmute(date = paste(year, month, day, sep = "/"))
```

```
#&gt; # A tibble: 336,776 x 1
#&gt;    date    
#&gt;    &lt;chr&gt;   
#&gt;  1 2013/1/1
#&gt;  2 2013/1/1
#&gt;  3 2013/1/1
#&gt;  4 2013/1/1
#&gt;  5 2013/1/1
#&gt;  6 2013/1/1
#&gt;  7 2013/1/1
#&gt;  8 2013/1/1
#&gt;  9 2013/1/1
#&gt; 10 2013/1/1
#&gt; # … with 336,766 more rows
```

---

## `distinct()` - find unique rows


```r
flights %&gt;%
  select(origin, dest) %&gt;%
  distinct() %&gt;%
  arrange(origin, dest)
```

```
#&gt; # A tibble: 224 x 2
#&gt;    origin dest 
#&gt;    &lt;chr&gt;  &lt;chr&gt;
#&gt;  1 EWR    ALB  
#&gt;  2 EWR    ANC  
#&gt;  3 EWR    ATL  
#&gt;  4 EWR    AUS  
#&gt;  5 EWR    AVL  
#&gt;  6 EWR    BDL  
#&gt;  7 EWR    BNA  
#&gt;  8 EWR    BOS  
#&gt;  9 EWR    BQN  
#&gt; 10 EWR    BTV  
#&gt; # … with 214 more rows
```

---

## Sampling rows

.pull-left[

`sample_n()`


```r
flights %&gt;% 
  select(year, origin) %&gt;% 
  sample_n(10)
```

```
#&gt; # A tibble: 10 x 2
#&gt;     year origin
#&gt;    &lt;int&gt; &lt;chr&gt; 
#&gt;  1  2013 EWR   
#&gt;  2  2013 LGA   
#&gt;  3  2013 EWR   
#&gt;  4  2013 LGA   
#&gt;  5  2013 LGA   
#&gt;  6  2013 EWR   
#&gt;  7  2013 LGA   
#&gt;  8  2013 EWR   
#&gt;  9  2013 EWR   
#&gt; 10  2013 LGA
```

]

.pull-right[

`sample_frac()`


```r
flights %&gt;% 
  select(year, origin) %&gt;% 
  sample_frac(.00001)
```

```
#&gt; # A tibble: 3 x 2
#&gt;    year origin
#&gt;   &lt;int&gt; &lt;chr&gt; 
#&gt; 1  2013 JFK   
#&gt; 2  2013 JFK   
#&gt; 3  2013 JFK
```

]

---

class: inverse, center, middle

# Exercises

---

## Data: Wake county parcels

Parcel boundaries with address and revenue-related information for properties in 
Wake County, NC. http://data-wake.opendata.arcgis.com/datasets/parcels

.small[

```r
wake &lt;- read_csv("https://www2.stat.duke.edu/~sms185/data/econ/parcels.csv")
```
]

---

.tiny[

```r
wake &lt;- 
  janitor::clean_names(wake)

glimpse(wake)
```

```
#&gt; Rows: 378,020
#&gt; Columns: 59
#&gt; $ objectid              &lt;dbl&gt; 31257151, 31257152, 31257153, 31257154, 3125715…
#&gt; $ pin_num               &lt;chr&gt; "1701518493", "0745330365", "0753213162", "1743…
#&gt; $ calc_area             &lt;dbl&gt; 0.59611048, 0.06596296, 0.17740871, 0.24685172,…
#&gt; $ reid                  &lt;chr&gt; "0004217", "0240874", "0337154", "0340605", "03…
#&gt; $ map_name              &lt;chr&gt; "1701 19", "0745 03", "0753 17", "1743 02", "18…
#&gt; $ owner                 &lt;chr&gt; "HAMILTON, HUBERT EARL HAMILTON, PATRICIA Y", "…
#&gt; $ addr1                 &lt;chr&gt; "500 POPLAR DR", "104 MADISON GROVE PL", "3038 …
#&gt; $ addr2                 &lt;chr&gt; "RALEIGH NC 27603-4330", "CARY NC 27519-8159", …
#&gt; $ addr3                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
#&gt; $ deed_book             &lt;chr&gt; "002618", "015772", "012192", "016213", "014787…
#&gt; $ deed_page             &lt;chr&gt; "00683", "00810", "00556", "00085", "01020", "0…
#&gt; $ deed_date             &lt;dttm&gt; 1978-01-01, 2014-09-04, 2006-09-29, 2015-11-16…
#&gt; $ deed_acres            &lt;dbl&gt; 0.60, 0.07, 0.18, 0.25, 0.26, 0.16, 1.15, 1.01,…
#&gt; $ bldg_val              &lt;dbl&gt; 0, 190388, 319131, 216470, 390623, 204414, 2476…
#&gt; $ land_val              &lt;dbl&gt; 27500, 102200, 90000, 40000, 85000, 40000, 5600…
#&gt; $ total_value_assd      &lt;dbl&gt; 27500, 292588, 409131, 256470, 475623, 244414, …
#&gt; $ billclass             &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 3, 2, 2, 2, 2, 2,…
#&gt; $ billing_class_decode  &lt;chr&gt; "Individual", "Individual", "Individual", "Indi…
#&gt; $ propdesc              &lt;chr&gt; "LO1 ECHO HTS SE7", "LO99 CARPENTER VILLAGE BLL…
#&gt; $ heatedarea            &lt;dbl&gt; NA, 1821, 3460, 2372, 3512, 2275, 2613, 1064, 3…
#&gt; $ stname                &lt;chr&gt; "HICKORY", "MADISON GROVE", "KILARNEY RIDGE", "…
#&gt; $ stype                 &lt;chr&gt; "LN", "PL", "LOOP", "DR", "DR", "DR", "CT", "RD…
#&gt; $ stpre                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
#&gt; $ stsuf                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
#&gt; $ stnum                 &lt;dbl&gt; 5626, 104, 3038, 4608, 1328, 4014, 1501, 8241, …
#&gt; $ stmisc                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
#&gt; $ site_address          &lt;chr&gt; "5626 HICKORY LN", "104 MADISON GROVE PL", "303…
#&gt; $ full_street_name      &lt;chr&gt; "HICKORY LN", "MADISON GROVE PL", "KILARNEY RID…
#&gt; $ city                  &lt;chr&gt; NA, "CAR", "CAR", "KNI", "WAK", "KNI", NA, NA, …
#&gt; $ city_decode           &lt;chr&gt; NA, "CARY", "CARY", "KNIGHTDALE", "WAKE FOREST"…
#&gt; $ planning_jurisdiction &lt;chr&gt; "GA", "CA", "CA", "KN", "WF", "KN", "WC", "WC",…
#&gt; $ township              &lt;chr&gt; "16", "05", "04", "17", "19", "17", "15", "15",…
#&gt; $ township_decode       &lt;chr&gt; "St. Mary's", "CEDAR FORK", "CARY", "St. Matthe…
#&gt; $ firedist              &lt;dbl&gt; 23, NA, NA, NA, NA, NA, 23, 23, 23, 23, 23, 23,…
#&gt; $ year_built            &lt;dbl&gt; NA, 2007, 2006, 2009, 2011, 2007, 1991, 1994, 1…
#&gt; $ totsalprice           &lt;dbl&gt; 3000, 235000, 340000, 204000, 420000, 206500, 2…
#&gt; $ sale_date             &lt;dttm&gt; 1978-01-01, 2014-09-04, 2006-09-29, 2015-11-16…
#&gt; $ type_and_use          &lt;chr&gt; NA, "01", "01", "01", "01", "01", "01", "72", "…
#&gt; $ type_use_decode       &lt;chr&gt; NA, "SINGLFAM", "SINGLFAM", "SINGLFAM", "SINGLF…
#&gt; $ designstyl            &lt;chr&gt; NA, "TWH", "CVL", "CVL", "CVL", "CVL", "CVL", "…
#&gt; $ design_style_decode   &lt;chr&gt; NA, "Townhouse", "Conventional", "Conventional"…
#&gt; $ units                 &lt;dbl&gt; 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1,…
#&gt; $ land_class            &lt;chr&gt; "VAC", "RHS", "RHS", "RHS", "RHS", "RHS", "RHS"…
#&gt; $ land_class_decode     &lt;chr&gt; "Vacant", "Residential Less Than 10 Acres", "Re…
#&gt; $ exemptdesc            &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "CEMETE…
#&gt; $ exemptstat            &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "782", …
#&gt; $ ownership             &lt;dbl&gt; 1010, 1010, 1010, 1010, 1010, 1010, 1010, 1020,…
#&gt; $ activity              &lt;dbl&gt; 9000, 1100, 1100, 1100, 1100, 1100, 1100, 1100,…
#&gt; $ `function`            &lt;dbl&gt; 9900, 1100, 1100, 1100, 1100, 1100, 1100, 1100,…
#&gt; $ structure             &lt;dbl&gt; 9000, 1140, 1110, 1110, 1110, 1110, 1110, 1152,…
#&gt; $ site                  &lt;dbl&gt; 1000, 6100, 6100, 6100, 6100, 6100, 6100, 6100,…
#&gt; $ totstructs            &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
#&gt; $ totunits              &lt;dbl&gt; 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1,…
#&gt; $ old_parcel_number     &lt;chr&gt; "680-00000-0614", "--", "--", "--", "--", "--",…
#&gt; $ zipnum                &lt;chr&gt; "27603", "27519", "27511", "27545", "27587", "2…
#&gt; $ shapearea             &lt;dbl&gt; 25966.573, 2873.347, 7727.923, 10752.861, 11405…
#&gt; $ shapelen              &lt;dbl&gt; 690.3185, 237.6056, 381.0306, 486.3749, 441.330…
#&gt; $ parcel_pk             &lt;dbl&gt; 72379, 375431, 324111, 326889, 375146, 348747, …
#&gt; $ land_code             &lt;chr&gt; "V", "R", "R", "R", "R", "R", "R", "R", "R", "R…
```
]

---

## Tasks

1. Which city has the fewest land parcels in the dataset? *Hint*: `count()`.
&lt;br&gt;&lt;br&gt;
   
2. Create a tibble that shows the year a parcel was built and the total
   value, where all parcels are located in Apex and are more than one acre in
   area. Sort the result in ascending order by year built.
&lt;br&gt;&lt;br&gt;

3. Choose a subset of five variables and 10 random rows from `wake` and save it 
   as an object named `wake_mini`. Experiment renaming variables with
   `select()` and `rename()` on `wake_mini`. What is the difference between the
   two functions?

???

## Solutions

.solution[

```r
wake %&gt;% 
  count(city_decode) %&gt;% 
  arrange(n) %&gt;% 
  slice(1)
```

```
#&gt; # A tibble: 1 x 2
#&gt;   city_decode     n
#&gt;   &lt;chr&gt;       &lt;int&gt;
#&gt; 1 CLAYTON         3
```

```r
wake %&gt;% 
  filter(city_decode == "APEX", calc_area &gt; 1) %&gt;% 
  select(year_built, total_value_assd) %&gt;% 
  arrange(year_built)
```

```
#&gt; # A tibble: 1,274 x 2
#&gt;    year_built total_value_assd
#&gt;         &lt;dbl&gt;            &lt;dbl&gt;
#&gt;  1          0          5250581
#&gt;  2       1870           275017
#&gt;  3       1890           636565
#&gt;  4       1890          1136357
#&gt;  5       1900          4310465
#&gt;  6       1910         10272692
#&gt;  7       1910          5244587
#&gt;  8       1910           483127
#&gt;  9       1920          1736577
#&gt; 10       1920           703483
#&gt; # … with 1,264 more rows
```

- Function `select()` only keeps the variables you mention.

- Function `rename()` keeps all variables.
]

---

## `summarise()`


```r
flights %&gt;%
  summarize(n(), min(dep_delay), max(dep_delay))
```

```
#&gt; # A tibble: 1 x 3
#&gt;    `n()` `min(dep_delay)` `max(dep_delay)`
#&gt;    &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;
#&gt; 1 336776               NA               NA
```

--


```r
flights %&gt;% 
  summarize(
    n = n(), 
    min_dep_delay = min(dep_delay, na.rm = TRUE), 
    max_dep_delay = max(dep_delay, na.rm = TRUE)
  )
```

```
#&gt; # A tibble: 1 x 3
#&gt;        n min_dep_delay max_dep_delay
#&gt;    &lt;int&gt;         &lt;dbl&gt;         &lt;dbl&gt;
#&gt; 1 336776           -43          1301
```

---

## Useful `summarise()` functions

- Center: `mean()`, `median()`
  
- Spread: `sd()`, `IQR()`, `mad()`

- Range: `min()`, `max()`, `quantile()`
 
- Position: `first()`, `last()`, `nth()`
 
- Count: `n()`, `n_distinct()`
 
- Logical: `any()`, `all()`

---

## `group_by()`


```r
flights %&gt;% 
  group_by(origin)
```


```r
# A tibble: 336,776 x 19
*# Groups:   origin [3]
    year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1  2013     1     1      517            515         2      830
 2  2013     1     1      533            529         4      850
 3  2013     1     1      542            540         2      923
 4  2013     1     1      544            545        -1     1004
 5  2013     1     1      554            600        -6      812
 6  2013     1     1      554            558        -4      740
 7  2013     1     1      555            600        -5      913
 8  2013     1     1      557            600        -3      709
 9  2013     1     1      557            600        -3      838
10  2013     1     1      558            600        -2      753
# … with 336,766 more rows, and 12 more variables:
#   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#   time_hour &lt;dttm&gt;
```

---

## `group_by()` then `summarise()`


```r
flights %&gt;% 
  group_by(origin) %&gt;%
  summarize(
    n = n(), 
    min_dep_delay = min(dep_delay, na.rm = TRUE), 
    max_dep_delay = max(dep_delay, na.rm = TRUE)
  )
```

```
#&gt; # A tibble: 3 x 4
#&gt;   origin      n min_dep_delay max_dep_delay
#&gt;   &lt;chr&gt;   &lt;int&gt;         &lt;dbl&gt;         &lt;dbl&gt;
#&gt; 1 EWR    120835           -25          1126
#&gt; 2 JFK    111279           -43          1301
#&gt; 3 LGA    104662           -33           911
```

---


```r
flights %&gt;% 
* group_by(origin, carrier) %&gt;%
  summarize(
    n             = n(), 
    min_dep_delay = min(dep_delay, na.rm = TRUE), 
    max_dep_delay = max(dep_delay, na.rm = TRUE),
*   .groups = "drop"
  ) %&gt;%
  filter(n &gt; 10000)
```

```
#&gt; # A tibble: 10 x 5
#&gt;    origin carrier     n min_dep_delay max_dep_delay
#&gt;    &lt;chr&gt;  &lt;chr&gt;   &lt;int&gt;         &lt;dbl&gt;         &lt;dbl&gt;
#&gt;  1 EWR    EV      43939           -25           548
#&gt;  2 EWR    UA      46087           -18           424
#&gt;  3 JFK    9E      14651           -24           747
#&gt;  4 JFK    AA      13783           -15          1014
#&gt;  5 JFK    B6      42076           -43           453
#&gt;  6 JFK    DL      20701           -18           960
#&gt;  7 LGA    AA      15459           -24           803
#&gt;  8 LGA    DL      23067           -33           911
#&gt;  9 LGA    MQ      16928           -26           366
#&gt; 10 LGA    US      13136           -18           500
```

---

## `mutate()` with `group_by()`


```r
flights %&gt;% 
  group_by(origin) %&gt;%
  mutate(n = n()) %&gt;%
  select(origin, n)
```

```
#&gt; # A tibble: 336,776 x 2
#&gt; # Groups:   origin [3]
#&gt;    origin      n
#&gt;    &lt;chr&gt;   &lt;int&gt;
#&gt;  1 EWR    120835
#&gt;  2 LGA    104662
#&gt;  3 JFK    111279
#&gt;  4 JFK    111279
#&gt;  5 LGA    104662
#&gt;  6 EWR    120835
#&gt;  7 EWR    120835
#&gt;  8 LGA    104662
#&gt;  9 JFK    111279
#&gt; 10 LGA    104662
#&gt; # … with 336,766 more rows
```

---

## Example


```r
flights %&gt;% 
  group_by(origin, month) %&gt;% 
  summarise(n = n()) %&gt;% 
  slice(1)
```

```
#&gt; # A tibble: 3 x 3
#&gt; # Groups:   origin [3]
#&gt;   origin month     n
#&gt;   &lt;chr&gt;  &lt;int&gt; &lt;int&gt;
#&gt; 1 EWR        1  9893
#&gt; 2 JFK        1  9161
#&gt; 3 LGA        1  7950
```

--

&lt;br/&gt;

**Why do I have a tibble with three rows?**

---

## You may need to `ungroup()`


```r
flights %&gt;% 
  group_by(origin, month) %&gt;% 
  summarise(n = n()) %&gt;% 
* ungroup() %&gt;%
  slice(1)
```

```
#&gt; # A tibble: 1 x 3
#&gt;   origin month     n
#&gt;   &lt;chr&gt;  &lt;int&gt; &lt;int&gt;
#&gt; 1 EWR        1  9893
```

--

Or set the `.groups` argument in `summarise()` to `"drop"`. This is a new
feature is `dplyr` version `1.0.0`.

---

## `case_when()` - multi-case `if_else()`

Suppose we want to break the parcel size into three categories:
small, medium, large. 

--

.small[

```r
wake %&gt;% 
  mutate(lot_size = case_when(
    deed_acres &lt; .5   ~ "small",
    deed_acres &lt; 1.5  ~ "medium",
    deed_acres &gt;= 1.5 ~ "large"
  )) %&gt;% 
  select(deed_acres, lot_size)
```

```
#&gt; # A tibble: 378,020 x 2
#&gt;    deed_acres lot_size
#&gt;         &lt;dbl&gt; &lt;chr&gt;   
#&gt;  1       0.6  medium  
#&gt;  2       0.07 small   
#&gt;  3       0.18 small   
#&gt;  4       0.25 small   
#&gt;  5       0.26 small   
#&gt;  6       0.16 small   
#&gt;  7       1.15 medium  
#&gt;  8       1.01 medium  
#&gt;  9       3.61 large   
#&gt; 10       1    medium  
#&gt; # … with 378,010 more rows
```
]

---

class: inverse, center, middle

# Exercises

---

## Tasks

Continue to use `wake` for the following tasks.

1. Compute the mean area for each design style.
&lt;br/&gt;

2. Compute the median sale price for each year. *Hint:* `lubridate::year()`
&lt;br/&gt;

3. Which city with at least 1,000 parcels classified as a "Townhouse"
   had the highest proportion of parcels as "Townhouse"?

???

## Solutions

.solution[


```r
wake %&gt;% 
  group_by(design_style_decode) %&gt;% 
  summarise(mean_area = mean(calc_area))
```

```
#&gt; # A tibble: 17 x 2
#&gt;    design_style_decode mean_area
#&gt;    &lt;chr&gt;                   &lt;dbl&gt;
#&gt;  1 Cape                   0.931 
#&gt;  2 Colonial               4.08  
#&gt;  3 Condo                  1.71  
#&gt;  4 Contemporary          24.5   
#&gt;  5 Conventional           1.01  
#&gt;  6 Conversion             0.448 
#&gt;  7 Duplex                 0.456 
#&gt;  8 Log                    6.89  
#&gt;  9 MANUF MULTI            1.68  
#&gt; 10 MANUF SNGL             2.73  
#&gt; 11 MODULAR                1.60  
#&gt; 12 NONE                  31.4   
#&gt; 13 Ranch                  0.813 
#&gt; 14 Split Foyer            0.449 
#&gt; 15 Split Level            0.476 
#&gt; 16 Townhouse              0.0595
#&gt; 17 &lt;NA&gt;                   3.66
```

```r
wake %&gt;% 
  filter(!is.na(sale_date)) %&gt;% 
  mutate(year = lubridate::year(sale_date)) %&gt;% 
  group_by(year) %&gt;% 
  summarise(median_sale_price = median(totsalprice, na.rm = TRUE))
```

```
#&gt; # A tibble: 62 x 2
#&gt;     year median_sale_price
#&gt;    &lt;dbl&gt;             &lt;dbl&gt;
#&gt;  1  1956               500
#&gt;  2  1958              8500
#&gt;  3  1961              1100
#&gt;  4  1962              5500
#&gt;  5  1963             15900
#&gt;  6  1964              6000
#&gt;  7  1965             47300
#&gt;  8  1966              6400
#&gt;  9  1967              8800
#&gt; 10  1968             17000
#&gt; # … with 52 more rows
```

```r
wake %&gt;% 
  count(city_decode, design_style_decode) %&gt;% 
  group_by(city_decode) %&gt;% 
  mutate(prop = n / sum(n)) %&gt;% 
  ungroup() %&gt;% 
  filter(design_style_decode == "Townhouse", n &gt;= 1000) %&gt;% 
  arrange(desc(prop)) %&gt;% 
  slice(1)
```

```
#&gt; # A tibble: 1 x 4
#&gt;   city_decode design_style_decode     n  prop
#&gt;   &lt;chr&gt;       &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt;
#&gt; 1 MORRISVILLE Townhouse            2379 0.318
```

]

---

## References

1. A Grammar of Data Manipulation. (2020). 
   https://dplyr.tidyverse.org/index.html

2. Parcels. (2020). Data-wake.opendata.arcgis.com. 
   http://data-wake.opendata.arcgis.com/datasets/parcels
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
